<div class="d-flex justify-content-center mt-5">
        <div class="card container w-100 w-md-75 mx-auto p-md-3 shadow-sm">
        <div class="card-header d-sm-flex justify-content-sm-between align-items-center">
            <h5 class="mb-md-0">Compra #{{ purchase.id }}</h5>
            <div class="d-flex gap-2">
              <button type="button" class="btn btn-outline-secondary btn-sm" (click)="printPurchase()">
                <i class="bi bi-printer me-1"></i> Imprimir compra
              </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" (click)="goBack()">Ver compras</button>
            </div>
        </div>
        <div class="row align-items-center py-4 g-4 px-3">
            <div class="col-sm-6">
                <span class="fw-medium">Fecha:</span>
                <span class="ps-2">{{ purchase.purchaseDate }}</span>
            </div>
            <div class="col-sm-6">
                <span class="fw-medium">Origen:</span>
                <span class="ps-2">{{ purchase.originalCenterName }}</span>
            </div>
            <div class="col-sm-6">
                <span class="fw-medium">Tipo:</span>
                <span class="ps-2">{{ purchase.type  }}</span>
            </div>
            <div class="col-sm-6">
                <span class="fw-medium">{{ purchase.originalCenterId === purchase.centerId ? 'Comprado por:' : 'Recibido por:'}}</span>
                <span class="ps-2">{{ purchase.buyerName }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Ítems de la compra -->
    <ui-table
    [title]="title"
    [displayedColumns]="displayedColumns"
    [mobileColumns]="mobileColumns"
    [dataSource]="items"
    [columnHeaders]="columnHeaders"
    [mobileHeaders]="mobileHeaders"
    [showSelectButton]="false"
    [showFilterButton]="false"
>
</ui-table>

<!-- Historial de Salidas -->
<div class="d-flex justify-content-center mt-5 mb-3">
    <div class="card container w-100 w-md-75 mx-auto p-md-3 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center" style="padding: 10px 8px;">
            <h5 class="mb-0">Historial de entregas</h5>
        </div>
    <div class="card-body p-0">
        <table class="table table-hover table-responsive overflow-x-auto mt-3 mobile-table">
            <thead>
                <tr>
                    <th class="fw-semibold mobile-header" style="font-size: 14px;">Fecha</th>
                    <th class="fw-semibold mobile-header" style="font-size: 14px;">Destino</th>
                    <th class="fw-semibold mobile-header" style="font-size: 14px;">Estado</th>
                    <th class="text-end"></th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let dist of purchase.distributions">
                    <tr (click)="toggleDetails(dist.id)" style="cursor: pointer;" [ngClass]="{'d-none': expandedDistId !== null && expandedDistId !== dist.id}">
                        <td class="mobile-cell" style="font-size: 14px;">{{ dist.deliveryDate | date:'dd/MM/yyyy' }}</td>
                        <td class="mobile-cell" style="font-size: 14px;">
                            <span *ngIf="dist.centerId !== 0">{{ dist.centerName }}</span>
                            <span *ngIf="dist.centerId === 0">{{ dist.personName }}</span>
                        </td>
                        <td class="mobile-cell" style="font-size: 14px;">{{ dist.status }}</td>
                        <td class="text-end">
                            <div class="btn-group btn-group-sm">
                                <button type="button" class="btn btn-outline-secondary"
                                        (click)="printDistribution(dist, $event)" title="Imprimir entrega">
                                  <i class="bi bi-printer"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary"
                                        (click)="toggleDetails(dist.id); $event.stopPropagation()" title="Ver detalle">
                                  <i class="bi" [ngClass]="{
                                    'bi-chevron-down': expandedDistId === dist.id,
                                    'bi-chevron-right': expandedDistId !== dist.id
                                  }"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <!-- Fila expandible con detalles -->
                    <tr *ngIf="expandedDistId === dist.id">
                        <td colspan="5" class="p-0">
                            <div class="p-3">
                                <strong>Detalle</strong>
                                <table class="table table-sm mt-2">
                                    <thead>
                                        <tr>
                                            <th class="fw-semibold mobile-header" style="font-size: 14px;">Producto</th>
                                            <th class="fw-semibold mobile-header text-center" style="font-size: 14px;">Cant.</th>
                                            <th class="fw-semibold mobile-header" style="font-size: 14px;">Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of dist.items">
                                            <td class="mobile-cell" style="font-size: 14px;">{{ item.productName }}</td>
                                            <td class="mobile-cell text-center" style="font-size: 14px;">{{ item.quantity }}</td>
                                            <td class="mobile-cell" style="font-size: 14px;">{{ item.description || '—' }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </td>
                    </tr>
                </ng-container>

                <!-- Mensaje cuando no hay nada -->
                <tr *ngIf="!purchase.distributions.length">
                    <td colspan="5" class="text-center py-3">Sin entregas registradas.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
